# ONEPAYサービスAPI仕様書 - 支払API

## 1. 概要

マーチャントシステムから受け取った支払リクエストをイシュアへ送信し、オーダID・取引ステータス・取引時間などの情報を応答します。

---

## 2. 使用シーン

以下のような場面で使用されます：

- 🧾 ユーザがバーコード／QRコードを提示し、店員がそれをマーチャントシステムに読み込む  
- 📲 読み込んだ支払情報を本システムへ送信し、支払手続きを完了する

---

## 3. 処理フロー概要

```text
[ユーザ端末] → [マーチャントシステム] → [ONEPAY] → [イシュア]

💡 このAPIは、加盟店が自社システムと決済プラットフォームを連携させるためのインターフェースを提供します。通信はHTTPSに限定され、パラメータはすべてUTF-8エンコードで送信してください。
🔐 認証方式
- X-API-Key：ヘッダーに指定されたAPIキーにより認証を行います。
- APIキーは管理画面で発行・無効化可能。
- リクエストごとに認証が必要で、有効期限はありません。
🔁 エンドポイント共通仕様
| 項目 | 内容 | 
| ベースURL | https://api.example.com/v1/payment | 
| 通信方式 | POST（すべてのリクエストはリクエストボディを伴います） | 
| コンテンツ型 | application/json | 
| タイムアウト | 30秒 | 
| リトライ方針 | 通信失敗時は最大3回まで自動リトライ（ステータスコードに応じて制御） | 


🧩 共通レスポンスフォーマット
{
  "status": "success",
  "code": "20000",
  "message": "正常に処理されました。",
  "data": {...}
}


- codeはビジネスエラーを表現するため、HTTPステータスとは別に定義されています。
リクエスト個別パラメータ（第3段）
🧾 このAPIは、加盟店が決済処理をリクエストする際に、以下のパラメータを個別に指定します。すべての項目はJSON形式のリクエストボディに含めてください。
🎯 パラメータ一覧
| パラメータ名 | 型 | 必須 | 説明 | 
| merchant_id | string | ✔ | 加盟店コード。プラットフォーム発行のユニークID。 | 
| order_id | string | ✔ | 加盟店側の注文番号。一意である必要があります。 | 
| amount | number | ✔ | 支払金額（円）。小数は利用不可。 | 
| currency | string | ✔ | 通貨コード。現時点では "JPY" のみ対応。 | 
| timestamp | string | ✔ | ISO 8601形式のタイムスタンプ。例：2025-07-25T18:37:00+09:00 | 
| description | string | ✘ | 任意の支払いメモ。画面や明細に表示される可能性あり。 | 
| customer_info | object | ✘ | 顧客情報。メール送付や識別用途に使用。 | 


🧮 顧客情報（customer_info オブジェクト）
| プロパティ名 | 型 | 必須 | 説明 | 
| email | string | ✘ | 顧客のメールアドレス（通知用途） | 
| name | string | ✘ | 顧客名（任意） | 
| phone | string | ✘ | 電話番号（任意） | 


📎 備考：
- 金額の上限やフォーマットについては事前に管理画面で設定確認してください。
- order_id は重複すると処理が拒否されるので注意。
- 通信失敗時の再送処理では、同一の order_id を再利用してください（冪等性保持）。
レスポンス仕様（第4段）
📨 決済APIは、処理結果を標準化されたJSON形式で返します。レスポンスボディには、業務ステータス・メッセージ・データなどが含まれます。
🧾 共通レスポンス構造
| フィールド名 | 型 | 説明 | 
| status | string | 処理結果ステータス。"success" または "error"。 | 
| code | string | 業務ステータスコード（5桁）。例：20000（正常）、40001（不正） | 
| message | string | 処理結果の説明文。画面表示やログ出力に使用可能。 | 
| data | object | 処理結果データ。成功時は取引情報、エラー時は空オブジェクト。 | 


📎 備考：
- HTTPステータスコードとは別に、業務コード（code）でエラー判定を行います。
- statusが"error"の場合、dataは空オブジェクト {} になります。
- messageはユーザー向けにも表示可能な内容を推奨します。
✅ 正常時レスポンス例
{
  "status": "success",
  "code": "20000",
  "message": "正常に処理されました。",
  "data": {
    "transaction_id": "TX20250725183900",
    "order_id": "ORD-8891-JP",
    "amount": 5800,
    "currency": "JPY",
    "processed_at": "2025-07-25T18:39:45+09:00"
  }
}


❌ 異常時レスポンス例
{
  "status": "error",
  "code": "40002",
  "message": "不正なパラメータが含まれています。",
  "data": {}
}

