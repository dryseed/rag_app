# ONEPAYサービスAPI仕様書 - インターフェース概要

## 1. 通信プロトコルと伝送方式

| 項目 | 内容 |
|------|------|
| アクセスドメイン | 本番環境：`gateway.onepay.finance`<br>検証環境：`test.onepay.finance` |
| 通信プロトコル | HTTPS |
| 伝送方式 | POST |
| データタイプ | JSON（リクエスト／レスポンス） |
| 文字コード | UTF-8 |
| デジタル署名アルゴリズム | SHA1WithRSA |

---

## 2. サービス接続モード

ONEPAYへの接続方式には「B2Cモード」と「B2Bモード」があり、インターフェース項目の設定値が一部異なります。

### 🧩 モード定義

| モード | 説明 |
|--------|------|
| B2Cモード | クライアント－サーバー通信。例：iOS／Android アプリから直接接続 |
| B2Bモード | サーバー－サーバー通信。例：ゲートウェイサーバーから接続 |

---

## 3. デジタル署名

通信データの正確性・完全性を担保するため、以下手順にて署名を生成・検証します。

### 🔐 署名生成手順

1. `sign`以外のリクエストパラメータをアルファベット順にソート（大文字・小文字区別なし）
2. キーと値の間を`=`で結合し、項目同士は`&`で連結
3. 結合した文字列を `{}` で囲む  
   例：`{partner_id=1001201111111212&service=create_order&trans_type=}`
4. 上記文字列を SHA-256 でハッシュ化（16進表記、大文字）
5. 秘密鍵 (2048bit) により RSA署名（アルゴリズム：SHA1WithRSA）
6. BASE64で2回エンコード → `sign`フィールドに設定

> 📝 空白フィールド（スペース, タブ, 改行など）も署名対象、nullは除外

### 🔍 署名検証

レスポンス受信時も、上記と同様の処理により署名検証を行う。`sign`をBASE64で2回デコードし、サーバー側で検証。

