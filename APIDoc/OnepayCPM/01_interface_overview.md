# インターフェース概要

## 通信プロトコルと伝送方式

ONEPAYシステムへ接続する上で必要となる通信プロトコルと伝送方式等について下記のように定める。

| 項目 | 内容 |
| --- | --- |
| アクセスドメイン | 本番環境：gateway.onepay.finance<br>検証環境：test.onepay.finance |
| 通信プロトコル | HTTPS |
| 伝送方式 | POST |
| データタイプ | リクエストまたはレスポンスの送受信データはJSONとする。 |
| 文字コード | UTF-8 |
| デジタル署名アルゴリズム | SHA1WithRSA |
| デジタル署名作成方法 | リクエスト及びレスポンス両方共にデジタル署名を検証する必要となること。<br>デジタル署名の詳細は「3.デジタル署名」をご参照ください。 |

## パラメータ規定

### サービス接続モード

OnePayへの接続には「B2Cモード」と「B2Bモード」がある。それにより、いくつかのインターフェース項目

の設定値が異なる場合がある。「B2Cモード」と「B2Bモード」の説明は以下に示す。

（1）B2Cモード　：クライアント－サーバー間通信。iOS/androidアプリ等の端末から、直接OnePayへ接続する方式である。

（2）B2Bモード　：サーバー間通信。ゲートウェイなどのサーバーから、OnePayへ接続する方式である。

### デジタル署名

通信データの正確性、完全性を確保するため、送信時はデジタル署名を作成し、受信時はデジタル署名を検証する。

(1)リクエストパラメータのsign以外の項目を、アルファベット順でソートする。（大文字、小文字を区別しない）

(2)項目（Key）と値（Value）の間は「＝」で連結し、項目と項目の間は「&」で連結する。

※Keyが存在し、かつValueが空白フィールドの場合でも、デジタル署名を行う必要がある。尚、空白フィールドとは、スペース （0x20）、タブ(0x09)、エンター(0x0d)、改行(0x0a)、空文字の５つを意味する。nullの場合は、署名対象とならない。

(3)連結した内容を{}括弧で括る。

例 ）項目と値の内容が下記①の場合、連結したデータは下記③のようになる。

① service=create_order, partner_id=1001201111111212, trans_type=

② partner_id=1001201111111212&service=create_order&trans_type=

③ {partner_id=1001201111111212&service=create_order&trans_type=}

(4)SHA-256によって(3)のデータをハッシュ化する。(16進文字列、且つ大文字である)

(5)デジタル証明書（秘密キー2048）によって署名する。署名のアルゴリズムは、SHA1WithRSAとなる。

(6)BASE64にて２回エンコードし、signフィールドに設定する。

※デジタル署名検証の流れが同様です。署名検証の際には、サーバー側から応答するsignをBase６４で2回デコードする